<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ALib: IToLiteral Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="aworx_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="A-Worx-Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ALib
   &#160;<span id="projectnumber">V. 1805 R. 0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceaworx.html">aworx</a></li><li class="navelem"><a class="el" href="namespaceaworx_1_1lib.html">lib</a></li><li class="navelem"><a class="el" href="namespaceaworx_1_1lib_1_1expressions.html">expressions</a></li><li class="navelem"><a class="el" href="structaworx_1_1lib_1_1expressions_1_1IToLiteral.html">IToLiteral</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Methods</a> &#124;
<a href="structaworx_1_1lib_1_1expressions_1_1IToLiteral-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">IToLiteral Struct Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="expressionslib_8hpp_source.html">expressionslib.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for IToLiteral:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="structaworx_1_1lib_1_1expressions_1_1IToLiteral__inherit__graph.svg" width="86" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for IToLiteral:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="structaworx_1_1lib_1_1expressions_1_1IToLiteral__coll__graph.svg" width="86" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<a name="details" id="details"></a><h2 class="groupheader">Class Description</h2>
<div class="textblock"><p>This <a class="el" href="namespaceaworx_1_1lib_1_1boxing.html#alib_namespace_boxing_interfaces">ALib boxing interface</a> is used to create parsable expression "literals" from constant values of custom type stored in boxes. The interface is used by the library in the following circumstances:</p><ul>
<li>If custom identifiers, functions or operator callback functions return a custom type.</li>
<li>If such types can be constants and are announced to the compiler as such.</li>
<li>If method <a class="el" href="classaworx_1_1lib_1_1expressions_1_1Expression.html#af308bc5925a29b75df5cf67a07dc2745">Expression::GetOptimizedString</a> is called.</li>
<li>And, not necessarily: if such string is to be used as input to compiling expressions</li>
</ul>
<p>The challenge here is to convert constants of custom types back into a normalized, human readable but also compilable expression string. As the expression syntax only defines the built-in literal types <a class="el" href="structaworx_1_1lib_1_1expressions_1_1Types.html#ab1a8ec377690a0cecfd0f3c70e1b970a">Integer</a>, <a class="el" href="structaworx_1_1lib_1_1expressions_1_1Types.html#aa813c9126cceb582e44aa5a6f4c8a541">Float</a> and <a class="el" href="structaworx_1_1lib_1_1expressions_1_1Types.html#a99e3e062a37dd9eae9b06b1f2a8ffb14">String</a>, the constants have to be created using either appropriate custom identifiers or "constructor functions" that have to be provided in addition along with the as soon as the conditions above are met. These identifiers and constructor functions in turn need to be compile-time evaluatable to ensure that recompiling the optimized string results to constants.</p>
<p>So far, this probably sounded a little complicated, but a step-by step sample taken from built-in date/time functionality demonstrates the use quite well:</p>
<ol type="1">
<li><p class="startli">Compiler plug-in <a class="el" href="structaworx_1_1lib_1_1expressions_1_1plugins_1_1DateAndTime.html">DateAndTime</a> introduces <b>ALib</b> class <a class="el" href="classaworx_1_1lib_1_1time_1_1TimePointBase_1_1Duration.html">TimePointBase::Duration</a> to expressions. This is for example done by defining identifiers as follows:</p>
<div class="fragment"><div class="line">        { *descriptor++, &amp;SIG_INT    , <a class="code" href="group__GrpALibMacros.html#ga66bc22b995956d786f1dacfb496f0fbd">CALCULUS_CALLBACK</a>(nanosecondsInt  ), <a class="code" href="structaworx_1_1lib_1_1expressions_1_1Types.html#a51d5b447dda0a9740c8d207617a86d89">Types::Duration</a> , CTI },</div></div><!-- fragment --><p> The "constructor functions" are declared to be <a class="el" href="structaworx_1_1lib_1_1expressions_1_1plugins_1_1Calculus.html#aca7d895c9d90f88412d70322cc52a758">compile-time invokable</a> and return are a constant at compile-time if their input parameter is constant. When the program - that may due to optimization not contain the identifiers any more - becomes de-compiled, these constants have to be written to the normalized expression string in a way that corresponding constant values of type <b>Duration</b> are expressed.</p>
</li>
</ol>
<p>To perform exactly this task, this boxing interface class is used. To enable the mechanism, static method <a class="el" href="structaworx_1_1lib_1_1expressions_1_1plugins_1_1DateAndTime.html#adc86235da98657bea0e04ea632faad0a">DateAndTime::Init</a> is invoked at bootstrap by the library. This announces a corresponding implementation named <b>IToLiteral_Duration</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// register ToLiteral interface for class DateTime::Duration with boxing</span></div><div class="line">boxing::DefineInterface&lt;time::DateTime::Duration, false, IToLiteral_Duration&gt;();</div></div><!-- fragment --><p> This interface is used on to decompile constants of custom types found in a program. The implementation is done in an anonymous namespace of the compilation unit of compiler plug-in <b>DateAndTime</b>. It looks as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>IToLiteral_Duration : <span class="keyword">public</span> <a class="code" href="structaworx_1_1lib_1_1expressions_1_1IToLiteral.html#a7290f1a70e699bcb3388b11aa571895b">IToLiteral</a>, <span class="keyword">public</span> <a class="code" href="namespaceaworx.html#a853db7b4d3eea2d12c2aef317b6110ee">Singleton</a>&lt;IToLiteral_Duration&gt;</div><div class="line">{</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structaworx_1_1lib_1_1expressions_1_1IToLiteral.html#aad4054c83089f4c401aca276261743c8">Invoke</a>( <span class="keyword">const</span> <a class="code" href="namespaceaworx.html#af923f654916f15a4287246e5bb3beabb">Box</a>&amp; constantValue, <a class="code" href="namespaceaworx.html#a97d89c97e084400c205acd8103539f61">AString</a>&amp; expressionString )</div><div class="line">    {</div><div class="line">        <span class="comment">// unbox  the time span to nanoseconds</span></div><div class="line">        <span class="keyword">auto</span> duration= constantValue.Unbox&lt;DateTime::Duration&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> value= duration.InNanoseconds();</div><div class="line"></div><div class="line">        <span class="comment">// find the best matching magnitude</span></div><div class="line">        <a class="code" href="namespaceaworx.html#a7af8a9e3564064047a575c7ff5462de9">NString</a> result;</div><div class="line">        <span class="keywordflow">if</span>( value == 0 )</div><div class="line">            result= <span class="stringliteral">&quot;Milliseconds&quot;</span>;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            result= <span class="stringliteral">&quot;Nanoseconds&quot;</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>( (value % 1000) == 0 )</div><div class="line">            {</div><div class="line">                value/= 1000;</div><div class="line">                result= <span class="stringliteral">&quot;Microseconds&quot;</span>;</div><div class="line">                <span class="keywordflow">if</span>( (value % 1000) == 0 )</div><div class="line">                {</div><div class="line">                    value/= 1000;</div><div class="line">                    result= <span class="stringliteral">&quot;Milliseconds&quot;</span>;</div><div class="line">                    <span class="keywordflow">if</span>( (value % 1000) == 0 )</div><div class="line">                    {</div><div class="line">                        value/= 1000;</div><div class="line">                        result= <span class="stringliteral">&quot;Seconds&quot;</span>;</div><div class="line">                        <span class="keywordflow">if</span>( (value % 60) == 0 )</div><div class="line">                        {</div><div class="line">                            value/= 60;</div><div class="line">                            result= <span class="stringliteral">&quot;Minutes&quot;</span>;</div><div class="line">                            <span class="keywordflow">if</span>( (value % 60) == 0 )</div><div class="line">                            {</div><div class="line">                                value/= 60;</div><div class="line">                                result= <span class="stringliteral">&quot;Hours&quot;</span>;</div><div class="line">                                <span class="keywordflow">if</span>( (value % 24) == 0 )</div><div class="line">                                {</div><div class="line">                                    value/= 24;</div><div class="line">                                    result= <span class="stringliteral">&quot;Days&quot;</span>;</div><div class="line">                                }</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// write the function argument</span></div><div class="line">        expressionString &lt;&lt; result &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; value &lt;&lt; <span class="charliteral">&#39;)&#39;</span> ;</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p> As it can be understood from the code, the interface implementation tries to find the best matching "constructor function" for time span given, writes its name and the constant parameter enclosed by brackets <code>"()"</code>.</p>
<p>Only with such interface implementation in place - one that covers all possible constants - this library is able to create <b>parsable, normalized, optimized expression strings</b>. To finalize this example, see what the result for three sample expressions look like:</p>
<div class="fragment"><div class="line">Input:          Milliseconds(1)</div><div class="line">Normalized:     Milliseconds( 1 )</div><div class="line">Optimized:      Milliseconds(1)</div><div class="line">Program Length: 1</div></div><!-- fragment --> <div class="fragment"><div class="line">Input:          Milliseconds(1) * 1000</div><div class="line">Normalized:     Milliseconds( 1 ) * 1000</div><div class="line">Optimized:      Seconds(1)</div><div class="line">Program Length: 1</div></div><!-- fragment --> <div class="fragment"><div class="line">Input:          Minutes(18) + Seconds(23)</div><div class="line">Normalized:     Minutes( 18 ) + Seconds( 23 )</div><div class="line">Optimized:      Seconds(1103)</div><div class="line">Program Length: 1</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>When integrating module <b>ALib Expressions</b> into a software, a decision has to be taken: "Should optimized expression strings be presented to the end-user?"<br />
</dd>
<dd>
While it is obvious, that sample two demonstrates that to be useful, sample three probably demonstrates the opposite!<br />
 It is important to understand, that the decision depends on the custom use case, where for example the technical understanding of a typical end-user may be taken into account.</dd>
<dd>
If the decision is taken, <b>not</b> to present optimized expression strings to the end-user, this has absolutely no influence on the evaluation performance: All three expressions,<ul>
<li>the original input,</li>
<li>the normalized output and</li>
<li>the optimized, normalized output, </li>
</ul>
</dd>
<dd>
are leading to the very same (optimized) internal program when compiled!</dd>
<dd>
Of-course, if no optimization strings are presented to the end-user and hence are not recompiled (or copy/pasted by such users), then the implementation of this boxing interface is not needed for your custom type, as it is only invoked with method <a class="el" href="classaworx_1_1lib_1_1expressions_1_1Expression.html#af308bc5925a29b75df5cf67a07dc2745">Expression::GetOptimizedString</a>! </dd></dl>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Methods</h2></td></tr>
<tr class="memitem:a7290f1a70e699bcb3388b11aa571895b"><td class="memItemLeft" align="right" valign="top"><a id="a7290f1a70e699bcb3388b11aa571895b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaworx_1_1lib_1_1expressions_1_1IToLiteral.html#a7290f1a70e699bcb3388b11aa571895b">IToLiteral</a> ()</td></tr>
<tr class="memdesc:a7290f1a70e699bcb3388b11aa571895b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor providing our runtime type to the parent. <br /></td></tr>
<tr class="separator:a7290f1a70e699bcb3388b11aa571895b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad4054c83089f4c401aca276261743c8"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="group__GrpALibMacros.html#ga74fe706f3101d8e1e21555f772da2849">ALIB_API</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaworx_1_1lib_1_1expressions_1_1IToLiteral.html#aad4054c83089f4c401aca276261743c8">Invoke</a> (const <a class="el" href="namespaceaworx.html#af923f654916f15a4287246e5bb3beabb">Box</a> &amp;constantValue, <a class="el" href="namespaceaworx.html#a97d89c97e084400c205acd8103539f61">AString</a> &amp;expressionString)=0</td></tr>
<tr class="separator:aad4054c83089f4c401aca276261743c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface')"><img src="closed.png" alt="-"/>&#160;Public Methods inherited from <a class="el" href="classaworx_1_1lib_1_1boxing_1_1Interface.html">Interface</a></td></tr>
<tr class="memitem:a7fc03ce9a2c1652fdb17279f1b25e652 inherit pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1boxing_1_1Interface.html#a7fc03ce9a2c1652fdb17279f1b25e652">Interface</a> (const std::type_info &amp;type)</td></tr>
<tr class="separator:a7fc03ce9a2c1652fdb17279f1b25e652 inherit pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d07a756bb96ccfc79568730847385b4 inherit pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1boxing_1_1Interface.html#a8d07a756bb96ccfc79568730847385b4">~Interface</a> ()</td></tr>
<tr class="separator:a8d07a756bb96ccfc79568730847385b4 inherit pub_methods_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_attribs_classaworx_1_1lib_1_1boxing_1_1Interface"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classaworx_1_1lib_1_1boxing_1_1Interface')"><img src="closed.png" alt="-"/>&#160;Protected Fields inherited from <a class="el" href="classaworx_1_1lib_1_1boxing_1_1Interface.html">Interface</a></td></tr>
<tr class="memitem:a850d0a52a5a9215400d3f7e4d3b12025 inherit pro_attribs_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memItemLeft" align="right" valign="top">const std::type_info &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classaworx_1_1lib_1_1boxing_1_1Interface.html#a850d0a52a5a9215400d3f7e4d3b12025">typeInfo</a></td></tr>
<tr class="separator:a850d0a52a5a9215400d3f7e4d3b12025 inherit pro_attribs_classaworx_1_1lib_1_1boxing_1_1Interface"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aad4054c83089f4c401aca276261743c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad4054c83089f4c401aca276261743c8">&#9670;&nbsp;</a></span>Invoke()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="group__GrpALibMacros.html#ga74fe706f3101d8e1e21555f772da2849">ALIB_API</a> void Invoke </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceaworx.html#af923f654916f15a4287246e5bb3beabb">Box</a> &amp;&#160;</td>
          <td class="paramname"><em>constantValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceaworx.html#a97d89c97e084400c205acd8103539f61">AString</a> &amp;&#160;</td>
          <td class="paramname"><em>expressionString</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The interface method taking the box of type <b>TickSpan</b> and the expression string to write the "literal" value into.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">constantValue</td><td>The constant program value that is about to be written into <span>expressionString</span>. </td></tr>
    <tr><td class="paramname">expressionString</td><td>The expression string that is currently generated. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="expressionslib_8hpp_source.html">expressionslib.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.12-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat May 12 2018 15:57:47 for ALib by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
